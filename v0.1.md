# Open Agent Commerce Protocol (OACP) Specification - Draft v0.1

**Important Note:** This document is a **v0.1 Draft** and serves as a technical discussion basis. It assumes that a successful OAEP connection has already been established between the interacting agents.

## 1. Purpose & Principles

*   **Purpose:** The Open Agent Commerce Protocol (OACP) standardizes fair, transparent, and legally binding commerce between AI agents. It is a Layer 1 application protocol that builds upon the Open Agent Exchange Protocol (OAEP).

*   **Principles:**
    *   **Semantic Interoperability:** Utilizes JSON-LD and established vocabularies (like Schema.org) to make requests and offers machine-readable and unambiguous.
    *   **Fact-Based & Verifiable:** Commercial claims (e.g., "Organic Product," "Made in Europe") **MUST** be provable through W3C Verifiable Credentials (VCs).
    *   **Legal Certainty:** Binding transactions are secured through eIDAS-compliant electronic signatures provided by the user.

## 2. Core Vocabulary (Extension of the OAEP Context)

OACP extends the vocabulary with specific intents and objects for commerce.

*   **Core Intents:**
    *   `NegotiateRequest`: A request from a buyer agent seeking offers for a product or service that meets specific criteria.
    *   `OfferResponse`: The response from a seller agent containing a concrete, binding offer.
    *   `OrderRequest`: The legally binding order from a buyer agent, referencing a specific `OfferResponse` and signed by the user.
    *   `OrderConfirmation`: The confirmation from the seller agent that the order has been accepted.

*   **Core Objects:**
    *   `Product`, `Service`: Description of the commercial object, ideally using Schema.org types.
    *   `PriceSpecification`: Detailed price information.
    *   `VerifiableCredential`: Evidence for product attributes.
    *   `userProof`: The user's digital signature that authorizes a transaction.

## 3. The Standard Transaction Flow (Example: Product Purchase)

**Prerequisite:** Agent A (Buyer) and Agent B (Seller) have successfully completed an OAEP handshake.

**Step 1: `NegotiateRequest` (Agent A -> Agent B)**
Agent A sends a request to get offers for a laptop.

```json
{
  "@context": "https://openagentprotocol.org/contexts/oacp/v1",
  "type": "NegotiateRequest",
  "intent": {
    "productType": "schema:LaptopComputer",
    "constraints": {
      "price": { "max": 1500, "currency": "EUR" },
      "attributes": [
        { "property": "schema:memory", "value_min": "16 GB" },
        { "property": "schema:screenSize", "value": "14 inch" }
      ],
      "requiredCredentials": [
        { "type": "EcoFriendlyCertified" }
      ]
    }
  }
}
```

**Step 2: `OfferResponse` (Agent B -> Agent A)**
Agent B replies with a concrete offer that meets the criteria, backed by a Verifiable Credential.

```json
{
  "@context": "https://openagentprotocol.org/contexts/oacp/v1",
  "type": "OfferResponse",
  "offerId": "offer-uuid-5678-abcd", // Unique ID for this offer
  "product": {
    "@type": "schema:LaptopComputer",
    "name": "EcoPro Laptop 14",
    "description": "...",
    "memory": "16 GB RAM",
    "screenSize": "14 inch"
  },
  "price": {
    "@type": "schema:PriceSpecification",
    "price": 1450,
    "priceCurrency": "EUR"
  },
  "verifiableCredentials": [
    {
      "@context": ["https://www.w3.org/2018/credentials/v1"],
      "type": ["VerifiableCredential", "EcoFriendlyCertified"],
      "issuer": "did:key:z6Mko...", // DID of the certification body
      "issuanceDate": "...",
      "credentialSubject": { "id": "EcoPro Laptop 14" },
      "proof": { ... }
    }
  ],
  "validUntil": "2026-02-20T18:00:00Z"
}
```

**Step 3: `OrderRequest` (Agent A -> Agent B)**
Agent A (on behalf of its user) accepts the offer. **This step is legally binding.** The payload contains the `offerId` and is signed by the user with their FES/QES.

```json
{
  "@context": "https://openagentprotocol.org/contexts/oacp/v1",
  "type": "OrderRequest",
  "offerId": "offer-uuid-5678-abcd",
  "paymentMethod": { ... },
  "deliveryAddress": { ... },
  "userProof": {
    // The signature generated by the user via the hardware enclave (e.g., in JWS format)
    "type": "Eidas_QES_Signature_2014",
    "proofValue": "eyJhbGciOiJ..."
  }
}
```

**Step 4: `OrderConfirmation` (Agent B -> Agent A)**
Agent B validates the `userProof` (the user's signature). If valid, it confirms the order. **This message is the trigger for the payment process.**

```json
{
  "@context": "https://openagentprotocol.org/contexts/oacp/v1",
  "type": "OrderConfirmation",
  "orderId": "order-uuid-9876-wxyz",
  "offerId": "offer-uuid-5678-abcd",
  "expectedDeliveryDate": "2026-02-25",

  // Handover to the Open Agent Payment Protocol (OAPP)
  "paymentRequest": {
    "@context": "https://openagentprotocol.org/contexts/oapp/v1",
    "type": "PaymentRequest",
    "amount": 1450,
    "currency": "EUR",
    "recipientWallet": "did:euro:de:bank:1234..."
  }
}
```

## 4. Application to Other Use Cases

*   **Services/Freelancers:** The flow is identical. Instead of a `product`, a `Service` (e.g., `schema:WebDesignService`) is requested with parameters like `duration` and `startDate`.
*   **Travel Bookings:** A single request could encompass multiple objects (e.g., `schema:Flight`, `schema:Hotel`). This complexity would be represented in the `constraints` of the `NegotiateRequest`.

**Conclusion:** OACP creates a robust, flexible, and verifiable language for commerce in the Th!nk ecosystem. It replaces opaque websites and manipulative algorithms with a fair, data-driven dialogue between agents that respects the sovereignty of all participants.

## 5. Transactional Integrity: Atomicity & Dispute Resolution

**Problem:** A simple, stateless sequence of messages is insufficient for valuable commercial transactions. OACP must solve two critical real-world problems:
1.  **Atomicity:** How can it be guaranteed that a payment is inextricably linked to the delivery of a good or service (the "all or nothing" principle)?
2.  **Dispute Resolution:** What happens if one party fails to meet its obligations (e.g., defective product, service not rendered)?

### 5.1 Mechanism for Ensuring Atomicity (Order & Payment Linking)

OACP and OAPP work together to ensure a quasi-atomic transaction via a two-phase model based on cryptographic linkages.

*   **Phase 1: Commitment:**
    *   The seller's `OrderConfirmation` message is more than a simple acknowledgment; it is a legally binding commitment.
    *   **Protocol Requirement:** The `OrderConfirmation` **MUST** contain the complete `paymentRequest` object (as defined in OAPP). This object includes all payment details and the unique `orderId` of the order.

*   **Phase 2: Execution:**
    *   The `PaymentAuthorization` message sent by the buyer agent via OAPP **MUST** reference the same `orderId`.
    *   **Effect:** This creates an unbreakable, bidirectional cryptographic link between the order and the payment. A payment can only be authorized for a specific, confirmed order.

*   **Optional Escrow Protocol:**
    *   For high-value or low-trust transactions, OACP can initiate an optional escrow flow. A neutral third agent (the "Escrow Agent") is agreed upon. The payment via OAPP is sent to the Escrow Agent and is only released to the seller after the buyer agent cryptographically confirms receipt of the goods (e.g., by signing a `DeliveryConfirmation`).

### 5.2 Framework for Dispute Resolution

OACP replaces the intransparent policies of centralized platforms with a transparent, fair, and evidence-based protocol flow.

*   **Guiding Principle: Cryptographic Evidence (Verifiable Credentials as Evidence):** The entire transaction history—from the `OfferResponse` with product attributes as VCs to the signed `OrderRequest`—creates a chain of tamper-proof digital evidence.

*   **The Process:**
    1.  **Initiation:** The buyer agent can open a conflict by sending a `DisputeRequest` message to the seller agent, referencing the original `orderId` and stating the reason.
    2.  **Direct Resolution:** The protocol first provides a phase for the parties to resolve the conflict directly (e.g., via a `RefundOffer` message from the seller).
    3.  **Optional Arbitration:** If the parties cannot agree, they can agree on a neutral third-party agent, the "Arbiter". The `DisputeRequest` can already include suggestions for Arbiter DIDs.
    4.  **Submission of Evidence:** Both parties submit their cryptographic evidence to the Arbiter.
    5.  **Decision:** The Arbiter makes a decision and issues it as a signed `DisputeResolution` message, which includes the verdict (e.g., "Full Refund," "Partial Refund") and a justification.

*   **Enforcement:** The Arbiter's signed `DisputeResolution` message can programmatically trigger the release of funds from an escrow contract or serve as powerful, legally relevant evidence for civil proceedings outside the protocol.

**Conclusion:** With these mechanisms, OACP creates a robust digital single market that is built not just on efficiency, but on provable fairness and transactional security.
